<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Snakebytes: Project Setup - Don't take my word for it, but...</title><meta name=Description content="Don't take my word for it, but..."><meta property="og:title" content="Snakebytes: Project Setup"><meta property="og:description" content="Python project configuration is not at all straightforward."><meta property="og:type" content="article"><meta property="og:url" content="https://rbrincke.github.io/posts/snakebytes-project-setup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-05T07:37:46+02:00"><meta property="article:modified_time" content="2023-07-05T07:37:46+02:00"><meta property="og:site_name" content="Don't take my word for it, but..."><meta name=twitter:card content="summary"><meta name=twitter:title content="Snakebytes: Project Setup"><meta name=twitter:description content="Python project configuration is not at all straightforward."><meta name=application-name content="Don't take my word for it, but..."><meta name=apple-mobile-web-app-title content="Don't take my word for it, but..."><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://rbrincke.github.io/posts/snakebytes-project-setup/><link rel=prev href=https://rbrincke.github.io/posts/snakebytes_closure_late_binding/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Snakebytes: Project Setup","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/rbrincke.github.io\/posts\/snakebytes-project-setup\/"},"genre":"posts","keywords":"Python, configuration, programming","wordcount":674,"url":"https:\/\/rbrincke.github.io\/posts\/snakebytes-project-setup\/","datePublished":"2023-07-05T07:37:46+02:00","dateModified":"2023-07-05T07:37:46+02:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Robert ten Brincke"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Don't take my word for it, but...">Don't take my word for it, but...</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Don't take my word for it, but...">Don't take my word for it, but...</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Snakebytes: Project Setup</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Robert ten Brincke</a></span>&nbsp;<span class=post-category>included in <a href=/categories/snakebytes/><i class="far fa-folder fa-fw" aria-hidden=true></i>Snakebytes</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-07-05>2023-07-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;674 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#virtual-environments>Virtual environments</a></li><li><a href=#directory-structure>Directory structure</a></li><li><a href=#pycharm>PyCharm</a></li><li><a href=#running-tests-from-the-command-line>Running tests from the command line</a></li><li><a href=#bonus-using-your-code-in-other-projects>Bonus: Using your code in other projects</a></li></ul></nav></div></div><div class=content id=content><p>Python project configuration is not at all straightforward.</p><p>When I first started working with Python a few months back I naively assumed project configuration was opinionated, something akin to Java and Maven. I tried following a few examples with varying degrees of success (most of which were really quite different!) &ndash; nothing really worked well.</p><p>Python has been around for a long time, long enough for best practices and tooling to have changed. This means you&rsquo;re going to run into 10-year-old posts that are no longer relevant. Advice ranges from &lsquo;do whatever works&rsquo; to modifying paths to accommodate specific scenarios.</p><p>We&rsquo;ll focus on a setup that works well from PyCharm, supports running tests from the command line, and allows us to use code in other projects.</p><p>The remainder of this write-up assumes a clean Git repository as a starting point.</p><h2 id=virtual-environments>Virtual environments</h2><p>You may have multiple Python projects using different dependencies and different versions of the same dependencies. Python supports the creation of virtual environments (venv) that allows you to keep these environments separate.</p><p>In the root of your Git repository, create a new virtual environment:</p><pre tabindex=0><code class=language-commandline data-lang=commandline>python -m venv venv
</code></pre><p>Before you do install anything into it, activate it using <code>source venv/bin/activate</code>.</p><h2 id=directory-structure>Directory structure</h2><p>Lots of people say not to put your source code in a <code>/src</code> directory, but to put it in a folder named after the project. I actually find that using <code>/src</code> works very well and provides a clear and consistent directory structure. Within it is a single directory that contains the code.</p><p>Our setup also makes use a <code>/tests</code> directory containing an <code>/integration</code> and <code>/unit</code> subdirectory. Later on this allows us to easily run either unit tests, integration tests, or all tests.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>├── src
</span></span><span class=line><span class=cl>│   ├── projectname
</span></span><span class=line><span class=cl>│   │   ├── <span class=gs>__init__</span>.py
</span></span><span class=line><span class=cl>│   │   ├── code.py
</span></span><span class=line><span class=cl>├── tests
</span></span><span class=line><span class=cl>│   ├── integration
</span></span><span class=line><span class=cl>│   │   ├── <span class=gs>__init__</span>.py
</span></span><span class=line><span class=cl>│   │   ├── test_code.py
</span></span><span class=line><span class=cl>│   ├── unit
</span></span><span class=line><span class=cl>│   │   ├── <span class=gs>__init__</span>.py
</span></span><span class=line><span class=cl>│   │   ├── test_code.py
</span></span><span class=line><span class=cl>├── venv
</span></span><span class=line><span class=cl>├── pyproject.toml
</span></span><span class=line><span class=cl>└── .gitignore
</span></span></code></pre></div><p>The build is described in <code>pyproject.toml</code> &ndash; it effectively replaces the legacy <code>setup.py</code> that lots of posts talk about. Our configuration makes use of <a href=https://setuptools.pypa.io/en/latest/# target=_blank rel="noopener noreffer">setuptools</a>, but other tools like poetry would work well too.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>build-system</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>requires</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;setuptools&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>build-backend</span> <span class=p>=</span> <span class=s2>&#34;setuptools.build_meta&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>project</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;projectname&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>authors</span> <span class=p>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;Code Author&#34;</span><span class=p>,</span> <span class=nx>email</span> <span class=p>=</span> <span class=s2>&#34;author@codeauthor.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;Project description.&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>requires-python</span> <span class=p>=</span> <span class=s2>&#34;&gt;=3.11&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>dependencies</span> <span class=p>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>setuptools</span><span class=p>.</span><span class=nx>packages</span><span class=p>.</span><span class=nx>find</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>where</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;src&#34;</span><span class=p>]</span>
</span></span></code></pre></div><h2 id=pycharm>PyCharm</h2><p>We&rsquo;re going to want this to work well in an IDE too, our tool of choice is PyCharm Community.</p><p>Open PyCharm, click <code>File » Open</code>, navigate to the directory containing your Git repository (click the entire folder), and open it. PyCharm should automatically detect your virtual environment, shown at the bottom right. If it does not, you can change it manually by clicking it and selecting <code>venv/bin/python3</code> from your virtual environment.</p><p>For tests and imports to work well, PyCharm needs to be told where the key parts of the code are. Mark (right-click the folder <code>» Mark Directory As</code>) the <code>/src</code> directory as the <code>Source Root</code> (blue) and the <code>/tests</code> directory as the <code>Test Sources Root</code> (green).</p><p>At this point you should be able to run unit tests directly from the IDE and imports should work as expected.</p><h2 id=running-tests-from-the-command-line>Running tests from the command line</h2><p>To run tests from the command line we&rsquo;ll use <a href=https://docs.pytest.org/en/7.4.x/ target=_blank rel="noopener noreffer">pytest</a> (which is compatible with the ubiquitous <code>unittest</code>). Pytest is simple, rich, provides clear test output, and supports junit XML reports.</p><p>Activate the virtual environment and install it.</p><pre tabindex=0><code class=language-commandline data-lang=commandline>source venv/bin/activate
pip install -U pytest
</code></pre><p>If you try to run the tests now, you&rsquo;ll end up with import errors. To fix this, perform an <a href=https://setuptools.pypa.io/en/latest/userguide/development_mode.html target=_blank rel="noopener noreffer">editable installation</a> of your project.</p><pre tabindex=0><code class=language-commandline data-lang=commandline>pip install --editable .
</code></pre><p>You can now run the tests in three different ways:</p><ul><li><code>pytest tests/unit</code> to run the unit tests</li><li><code>pytest tests/integration</code> to run the integration tests</li><li><code>pytest tests</code> to run all tests</li></ul><h2 id=bonus-using-your-code-in-other-projects>Bonus: Using your code in other projects</h2><p>Because this is a proper project, it is easy to use this code from other projects.</p><pre tabindex=0><code class=language-commandline data-lang=commandline>pip install git+https://github.com/user/project.git
</code></pre></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-07-05</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://rbrincke.github.io/posts/snakebytes-project-setup/ data-title="Snakebytes: Project Setup" data-via=rhwtenbrincke data-hashtags=Python,configuration,programming><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://rbrincke.github.io/posts/snakebytes-project-setup/ data-hashtag=Python><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://rbrincke.github.io/posts/snakebytes-project-setup/ data-title="Snakebytes: Project Setup"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://rbrincke.github.io/posts/snakebytes-project-setup/ data-title="Snakebytes: Project Setup"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://rbrincke.github.io/posts/snakebytes-project-setup/ data-title="Snakebytes: Project Setup"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/python/>Python</a>,&nbsp;<a href=/tags/configuration/>configuration</a>,&nbsp;<a href=/tags/programming/>programming</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/snakebytes_closure_late_binding/ class=prev rel=prev title="Snake bytes: Python's late binding for closures"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Snake bytes: Python's late binding for closures</a></div></div></article></div></main></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>